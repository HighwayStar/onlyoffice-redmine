<%=
    @file_id = file_id
    @file = Attachment.find_by_id(@file_id)
    @file_name = @file.filename[0..@file.filename.index(".")-1]
    @ext = @file.filename[@file.filename.index(".")+1..]

    @formats = FormatUtility.format_supported(@ext)
%>

<%= stylesheet_link_tag 'onlyofficeConversion', plugin: 'onlyoffice_redmine' %>


<div id = "donwload_as" tabindex="-1" role="dialog" class="none ui-dialog ui-corner-all ui-widget ui-widget-content ui-front modal ui-draggable" aria-describedby="ajax-modal" aria-labelledby="ui-id-2" style="height: auto; width: 600px; top: 271.9px; left: 454.5px; z-index: 101;">
    <div class="ui-dialog-titlebar ui-corner-all ui-widget-header ui-helper-clearfix ui-draggable-handle">
        <span id="ui-id-2" class="ui-dialog-title"><%= l(:onlyoffice_convert_download_file_as) %></span>
        <button onclick = "displayFormDownloadAs(false);" type="button" class="ui-button ui-corner-all ui-widget ui-button-icon-only ui-dialog-titlebar-close" title="Close">
            <span class="ui-button-icon ui-icon ui-icon-closethick"></span>
            <span class="ui-button-icon-space"></span>
            Close
        </button>
    </div>
    <div style="width: auto; min-height: 100.4px; max-height: none; height: auto;" class="ui-dialog-content ui-widget-content">
        <h3 class="title"><%= l(:onlyoffice_convert_download_file_as) %></h3>

        <%= form_tag(onlyoffice_convert_path(@file_id,@file_id), multipart: true, id: "conversion") do |f| %>
            <%= hidden_field_tag 'type', "download_as" %>
            <%= hidden_field_tag 'ajax', true %>
            <%= render :partial => 'onlyoffice_convert/form' %>
            <div style = "display: flex; align-items: center;" >
                <p><%= submit_tag l(:label_no_preview_download) %></p>
                <div id="progress_bar" style = "display: none">
                    <div id="progress"></div>
                    <%= label_tag "progress", "0%", id: "progress_label" %>
                </div>
                <div id="onlyoffice-notification" style="display: none; width: 100%; padding-top: 0.5%;">
                    <div></div>
                </div>
            </div>

        <% end %>
    </div>
</div>


<script type="text/javascript" language="javascript">
    document.body.appendChild(document.getElementById("donwload_as"))
    var ajaxUrl = '<%= onlyoffice_convert_path(@file_id,@file_id) %>';

    var isDisable = function (bool) {
        $('#conversion input[type=submit]')[0].disabled = bool;
    }
</script>

<%= javascript_include_tag "onlyofficeConversion", :plugin => "onlyoffice_redmine" %>

<script type="text/javascript" language="javascript">
    displayFormDownloadAs(false);
</script>