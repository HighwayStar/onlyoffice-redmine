<%#
# (c) Copyright Ascensio System SIA 2022
# http://www.onlyoffice.com
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
%>
<% if User.current.allowed_to?(:add_documents, @file.project) %>
<%= stylesheet_link_tag 'onlyofficeConversion', plugin: 'onlyoffice_redmine' %>

    <h2><%= l(:onlyoffice_convert_dropdown) %></h2>
    <h2><%= @file.filename %></h2>

<%= form_tag(onlyoffice_convert_path(@page.id), multipart: true, id: "conversion") do |f| %>
    <%= hidden_field_tag 'back_page', back_url %>
    <%= hidden_field_tag 'type', "" %>
    <%= hidden_field_tag 'ajax', true %>
    <%= render :partial => 'form', :locals => {:f => f} %>
    <div style = "display: flex; align-items: center;" >
        <p><%= submit_tag l(:onlyoffice_convert_submit), onclick: "isButton(this)", id: "convert", data: { disable_with: false }%></p>
        <p><%= submit_tag l(:label_no_preview_download), onclick: "isButton(this)", id: "download_as", data: { disable_with: false } %></p>
        <p><%= link_to l(:button_cancel), back_url %></p>
        <div id="progress_bar" style = "display: none">
            <div id="progress"></div>
            <%= label_tag "progress", "0%", id: "progress_label" %>
        </div>
        <div id="onlyoffice-notification">
            <div></div>
        </div>
    </div>

<% end %>


<script type="text/javascript" language="javascript">
    var isDisable = function (bool) {
        $('#convert')[0].disabled = bool;
        $('#download_as')[0].disabled = bool;
    }
    var isButton = function (element) {
        $('#type')[0].value = element.id;
    }

    var form = $('#conversion')[0];
    var ajaxUrl = '<%= onlyoffice_convert_path(@page.id) %>';

    form.addEventListener("submit", function(event) {
        isDisable(true);
        showProgress(true);
        event.preventDefault();
        sendSubmit();
        setTimeout(isDisable, 3000, false);
    }, false );

</script>
<%= javascript_include_tag "onlyofficeConversion", :plugin => "onlyoffice_redmine" %>

<% end %>